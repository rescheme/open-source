"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}Object.defineProperty(exports,"__esModule",{value:!0});var SIDEBARJS="sidebarjs",SIDEBARJS_CONTENT="sidebarjs-content",IS_VISIBLE="".concat(SIDEBARJS,"--is-visible"),IS_MOVING="".concat(SIDEBARJS,"--is-moving"),LEFT_POSITION="left",RIGHT_POSITION="right",POSITIONS=[LEFT_POSITION,RIGHT_POSITION],SidebarElement=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.toggle=function(){t.isVisible()?t.close():t.open()},this.open=function(){t.component.classList.add(IS_VISIBLE),t.setBackdropOpacity(t.backdropOpacity)},this.close=function(){t.component.classList.remove(IS_VISIBLE),t.clearStyle(t.backdrop)},this._onTouchStart=function(e){t.initialTouch=e.touches[0].pageX},this._onTouchMove=function(e){var n=-(t.initialTouch-e.touches[0].clientX);t.container.clientWidth+(t.hasLeftPosition()?n:-n)<=t.container.clientWidth&&(t.touchMoveSidebar=Math.abs(n),t.moveSidebar(n))},this._onTouchEnd=function(){t.component.classList.remove(IS_MOVING),t.clearStyle(t.container),t.clearStyle(t.backdrop),t.touchMoveSidebar>t.container.clientWidth/3.5?t.close():t.open(),t.initialTouch=null,t.touchMoveSidebar=null},this._onSwipeOpenStart=function(e){if(!t.targetElementIsBackdrop(e)){var n=e.touches[0].clientX;(t.hasLeftPosition()?n:document.body.clientWidth-n)<t.documentSwipeRange&&t._onTouchStart(e)}},this._onSwipeOpenMove=function(e){if(!t.targetElementIsBackdrop(e)&&t.initialTouch&&!t.isVisible()){var n=e.touches[0].clientX-t.initialTouch,i=t.hasLeftPosition(),o=i?n:-n,s=t.container.clientWidth-o;s>0&&o>=t.documentMinSwipeX&&(t.openMovement=i?-s:s,t.moveSidebar(t.openMovement))}},this._onSwipeOpenEnd=function(){t.openMovement&&(t.openMovement=null,t._onTouchEnd())},this._onTransitionEnd=function(){var e=t.isVisible();e&&!t._wasVisible?(t._wasVisible=!0,t._emitOnOpen&&t._emitOnOpen()):!e&&t._wasVisible&&(t._wasVisible=!1,t._emitOnClose&&t._emitOnClose()),t._emitOnChangeVisibility&&t._emitOnChangeVisibility({isVisible:e})};var i=n.component,o=n.container,s=n.backdrop,a=n.documentMinSwipeX,r=void 0===a?10:a,c=n.documentSwipeRange,h=void 0===c?40:c,l=n.nativeSwipe,u=n.nativeSwipeOpen,p=n.responsive,v=void 0!==p&&p,d=n.mainContent,S=n.position,m=void 0===S?"left":S,f=n.backdropOpacity,y=void 0===f?.3:f,E=n.onOpen,b=n.onClose,O=n.onChangeVisibility,_=o&&s;if(this.component=i||document.querySelector("[".concat(SIDEBARJS,"]")),this.container=_?o:e.create("".concat(SIDEBARJS,"-container")),this.backdrop=_?s:e.create("".concat(SIDEBARJS,"-backdrop")),this.documentMinSwipeX=r,this.documentSwipeRange=h,this.nativeSwipe=!1!==l,this.nativeSwipeOpen=!1!==u,this.isStyleMapSupported=e.isStyleMapSupported(),this.responsive=Boolean(v),this.mainContent=this.shouldDefineMainContent(d),this.backdropOpacity=y,this.backdropOpacityRatio=1/y,this._emitOnOpen=E,this._emitOnClose=b,this._emitOnChangeVisibility=O,!_)try{this.transcludeContent()}catch(e){throw new Error("You must define an element with [sidebarjs] attribute")}this.setSwipeGestures(!0),(this.responsive||this.mainContent)&&this.setResponsive(),this.setPosition(m),this.addAttrsEventsListeners(this.component.getAttribute(SIDEBARJS)),this.addTransitionListener(),this.backdrop.addEventListener("click",this.close,{passive:!0})}return _createClass(e,[{key:"isVisible",value:function(){return this.component.classList.contains(IS_VISIBLE)}},{key:"destroy",value:function(){var e=this;for(this.removeNativeGestures(),this.container.removeEventListener("transitionend",this._onTransitionEnd,{passive:!0}),this.backdrop.removeEventListener("click",this.close,{passive:!0}),this.removeNativeOpenGestures(),this.removeAttrsEventsListeners(this.component.getAttribute(SIDEBARJS)),this.removeComponentClassPosition();this.container.firstElementChild;)this.component.appendChild(this.container.firstElementChild);this.component.removeChild(this.container),this.component.removeChild(this.backdrop),Object.keys(this).forEach(function(t){return e[t]=null})}},{key:"setPosition",value:function(e){var t=this;this.component.classList.add(IS_MOVING),this.position=POSITIONS.indexOf(e)>=0?e:LEFT_POSITION;var n=1===(document.querySelectorAll("[".concat(SIDEBARJS,"]"))||[]).length;this.removeComponentClassPosition(n),this.component.classList.add("".concat(SIDEBARJS,"--").concat(this.position)),this.responsive&&this.mainContent&&this.mainContent.classList.add("".concat(SIDEBARJS_CONTENT,"--").concat(this.position)),setTimeout(function(){return t.component&&t.component.classList.remove(IS_MOVING)},200)}},{key:"addAttrsEventsListeners",value:function(t){var n=this;this.forEachActionElement(t,function(t,i){e.elemHasListener(t)||(t.addEventListener("click",n[i],{passive:!0}),e.elemHasListener(t,!0))})}},{key:"removeAttrsEventsListeners",value:function(t){var n=this;this.forEachActionElement(t,function(t,i){e.elemHasListener(t)&&(t.removeEventListener("click",n[i]),e.elemHasListener(t,!1))})}},{key:"setSwipeGestures",value:function(e){if("boolean"!=typeof e)throw new Error("You provided a ".concat(_typeof(e)," value but setSwipeGestures needs a boolean value."));this.nativeSwipe&&(e?this.addNativeGestures():this.removeNativeGestures(),this.nativeSwipeOpen&&(e?this.addNativeOpenGestures():this.removeNativeOpenGestures()))}},{key:"addTransitionListener",value:function(){this._wasVisible=this.isVisible(),this.container.addEventListener("transitionend",this._onTransitionEnd,{passive:!0})}},{key:"forEachActionElement",value:function(e,t){for(var n=["toggle","open","close"],i=0;i<n.length;i++)for(var o=document.querySelectorAll("[".concat(SIDEBARJS,"-").concat(n[i],'="').concat(e,'"]')),s=0;s<o.length;s++)t(o[s],n[i])}},{key:"removeComponentClassPosition",value:function(e){for(var t=0;t<POSITIONS.length;t++)this.component.classList.remove("".concat(SIDEBARJS,"--").concat(POSITIONS[t])),e&&this.mainContent&&this.mainContent.classList.remove("".concat(SIDEBARJS_CONTENT,"--").concat(POSITIONS[t]))}},{key:"hasLeftPosition",value:function(){return this.position===LEFT_POSITION}},{key:"hasRightPosition",value:function(){return this.position===RIGHT_POSITION}},{key:"transcludeContent",value:function(){for(;this.component.firstChild;)this.container.appendChild(this.component.firstChild);for(;this.component.firstChild;)this.component.removeChild(this.component.firstChild);this.component.appendChild(this.container),this.component.appendChild(this.backdrop)}},{key:"addNativeGestures",value:function(){this.component.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.component.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.component.addEventListener("touchend",this._onTouchEnd,{passive:!0})}},{key:"removeNativeGestures",value:function(){this.component.removeEventListener("touchstart",this._onTouchStart,{passive:!0}),this.component.removeEventListener("touchmove",this._onTouchMove,{passive:!0}),this.component.removeEventListener("touchend",this._onTouchEnd,{passive:!0})}},{key:"addNativeOpenGestures",value:function(){document.addEventListener("touchstart",this._onSwipeOpenStart,{passive:!0}),document.addEventListener("touchmove",this._onSwipeOpenMove,{passive:!0}),document.addEventListener("touchend",this._onSwipeOpenEnd,{passive:!0})}},{key:"removeNativeOpenGestures",value:function(){document.removeEventListener("touchstart",this._onSwipeOpenStart,{passive:!0}),document.removeEventListener("touchmove",this._onSwipeOpenMove,{passive:!0}),document.removeEventListener("touchend",this._onSwipeOpenEnd,{passive:!0})}},{key:"moveSidebar",value:function(e){this.component.classList.add(IS_MOVING),this.applyStyle(this.container,"transform","translate(".concat(e,"px, 0)"),!0),this.updateBackdropOpacity(e)}},{key:"updateBackdropOpacity",value:function(e){var t=(1-Math.abs(e)/this.container.clientWidth)/this.backdropOpacityRatio;this.setBackdropOpacity(t)}},{key:"setBackdropOpacity",value:function(e){this.applyStyle(this.backdrop,"opacity",e.toString())}},{key:"targetElementIsBackdrop",value:function(e){return e.target.hasAttribute("".concat(SIDEBARJS,"-backdrop"))}},{key:"setResponsive",value:function(){if(!this.responsive&&this.mainContent)throw new Error("You provide a [".concat(SIDEBARJS_CONTENT,"] element without set {responsive: true}"));if(this.responsive&&!this.mainContent)throw new Error("You have set {responsive: true} without provide a [".concat(SIDEBARJS_CONTENT,"] element"));this.component.classList.add("sidebarjs--responsive")}},{key:"shouldDefineMainContent",value:function(e){return e?(e.setAttribute(SIDEBARJS_CONTENT,""),e):document.querySelector("[".concat(SIDEBARJS_CONTENT,"]"))}},{key:"applyStyle",value:function(e,t,n,i){this.isStyleMapSupported?e.attributeStyleMap.set(t,n):(e.style[t]=n,i&&(e.style["webkit"+t.charAt(0).toUpperCase()+t.slice(1)]=n))}},{key:"clearStyle",value:function(e){this.isStyleMapSupported?e.attributeStyleMap.clear():e.removeAttribute("style")}}],[{key:"isStyleMapSupported",value:function(){return Boolean(window.CSS&&CSS.number)}},{key:"create",value:function(e){var t=document.createElement("div");return t.setAttribute(e,""),t}},{key:"elemHasListener",value:function(e,t){return e&&"boolean"==typeof t?e.sidebarjsListener=t:!!e.sidebarjsListener}}]),e}(),SidebarService=function(){function e(){_classCallCheck(this,e),this.instances={}}return _createClass(e,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.component&&e.component.getAttribute("sidebarjs")||"";return this.instances[t]=new SidebarElement(e),this.instances[t]}},{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.instances[e]&&this.instances[e].open()}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.instances[e]&&this.instances[e].close()}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.instances[e]&&this.instances[e].toggle()}},{key:"isVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!this.instances[e]&&this.instances[e].isVisible()}},{key:"setPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.instances[t]&&this.instances[t].setPosition(e)}},{key:"elemHasListener",value:function(e,t){return SidebarElement.elemHasListener(e,t)}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.instances[e]&&(this.instances[e].destroy(),this.instances[e]=null,delete this.instances[e])}}]),e}();exports.SidebarElement=SidebarElement,exports.SidebarService=SidebarService;
