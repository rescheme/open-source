{"version":3,"file":"ispin.min.js","sources":["../src/ispin.js"],"sourcesContent":["// @flow\r\n\r\ntype SpinDirection = (1 | -1);\r\ntype SpinOptions = {\r\n  wrapperClass: string,\r\n  buttonsClass: string,\r\n  step: number,\r\n  pageStep: number,\r\n  repeatInterval: number,\r\n  wrapOverflow: boolean,\r\n  parse: string => number,\r\n  format: number => string,\r\n  disabled: boolean,\r\n  max?: number,\r\n  min?: number,\r\n  onChange?: string => void,\r\n};\r\n\r\n\r\nexport default\r\nclass ISpin {\r\n  static DEFAULTS: $Shape<SpinOptions>;\r\n  el: HTMLInputElement;\r\n  options: SpinOptions;\r\n  _onKeyDown: (e: KeyboardEvent) => void;\r\n  _onMouseDown: (e: MouseEvent) => void;\r\n  _onMouseUp: (e: MouseEvent) => void;\r\n  _onMouseLeave: (e: MouseEvent) => void;\r\n  _onWheel: (e: WheelEvent) => void;\r\n  _wrapper: HTMLElement;\r\n  _buttons: {\r\n    inc: HTMLButtonElement,\r\n    dec: HTMLButtonElement\r\n  };\r\n  _spinTimer: IntervalID;\r\n\r\n  constructor (el: HTMLInputElement, opts: $Shape<SpinOptions>) {\r\n    this.el = el;\r\n    // $FlowFixMe temporary assignment\r\n    this.options = {};\r\n\r\n    this._onKeyDown = this._onKeyDown.bind(this);\r\n    this._onMouseDown = this._onMouseDown.bind(this);\r\n    this._onMouseUp = this._onMouseUp.bind(this);\r\n    this._onMouseLeave = this._onMouseLeave.bind(this);\r\n    this._onWheel = this._onWheel.bind(this);\r\n\r\n    this.build();\r\n    this.update(opts);\r\n  }\r\n\r\n  build () {\r\n    // wrap element\r\n    this._wrapper = document.createElement('div');\r\n    if (this.el.parentNode) this.el.parentNode.replaceChild(this._wrapper, this.el);\r\n    this._wrapper.appendChild(this.el);\r\n\r\n    // add buttons\r\n    this._buttons = {\r\n      inc: document.createElement('button'),\r\n      dec: document.createElement('button')\r\n    };\r\n\r\n    // listen to events\r\n    Object.keys(this._buttons).forEach(k => {\r\n      const b = this._buttons[k];\r\n      this._wrapper.appendChild(b);\r\n      b.setAttribute('type', 'button');\r\n      b.addEventListener('mousedown', this._onMouseDown);\r\n      b.addEventListener('mouseup', this._onMouseUp);\r\n      b.addEventListener('mouseleave', this._onMouseLeave);\r\n    });\r\n    this.el.addEventListener('keydown', this._onKeyDown);\r\n    this.el.addEventListener('wheel', this._onWheel);\r\n  }\r\n\r\n  update (opts: $Shape<SpinOptions>) {\r\n    opts = {\r\n      ...ISpin.DEFAULTS,\r\n      ...this.options,\r\n      ...opts\r\n    };\r\n\r\n    // update wrapper class\r\n    if (opts.wrapperClass !== this.options.wrapperClass) {\r\n      if (this.options.wrapperClass) this._wrapper.classList.remove(this.options.wrapperClass);\r\n      if (opts.wrapperClass) this._wrapper.classList.add(opts.wrapperClass);\r\n    }\r\n\r\n    if (opts.buttonsClass !== this.options.buttonsClass) {\r\n      if (this.options.buttonsClass) {\r\n        Object.keys(this._buttons).forEach(k => {\r\n          this._buttons[k].classList.remove(this.options.buttonsClass);\r\n          this._buttons[k].classList.remove(this.options.buttonsClass + '-' + k);\r\n        });\r\n      }\r\n      if (opts.buttonsClass) {\r\n        Object.keys(this._buttons).forEach(k => {\r\n          this._buttons[k].classList.add(opts.buttonsClass);\r\n          this._buttons[k].classList.add(opts.buttonsClass + '-' + k);\r\n        });\r\n      }\r\n    }\r\n\r\n    this.disabled = opts.disabled;\r\n\r\n    Object.assign(this.options, opts);\r\n  }\r\n\r\n  destroy () {\r\n    if (this._wrapper.parentNode) this._wrapper.parentNode.replaceChild(this.el, this._wrapper);\r\n    delete this.el;\r\n    delete this._wrapper;\r\n    delete this._buttons;\r\n  }\r\n\r\n  _onKeyDown (e: KeyboardEvent) {\r\n    switch (e.keyCode) {\r\n      case 38: // arrow up\r\n        e.preventDefault();\r\n        return this.spin(this.options.step);\r\n      case 40: // arrow down\r\n        e.preventDefault();\r\n        return this.spin(-this.options.step);\r\n      case 33: // page up\r\n        e.preventDefault();\r\n        return this.spin(this.options.pageStep);\r\n      case 34: // page down\r\n        e.preventDefault();\r\n        return this.spin(-this.options.pageStep);\r\n    }\r\n  }\r\n\r\n  _onMouseDown (e: MouseEvent) {\r\n    e.preventDefault();\r\n\r\n    const direction: SpinDirection = e.currentTarget === this._buttons.inc ? 1 : -1;\r\n    this.spin(direction * this.options.step);\r\n    this.el.focus();\r\n\r\n    this._startSpinning(direction);\r\n  }\r\n\r\n  _onMouseUp (e: MouseEvent) {\r\n    this._stopSpinning();\r\n  }\r\n\r\n  _onMouseLeave (e: MouseEvent) {\r\n    this._stopSpinning();\r\n  }\r\n\r\n  _startSpinning (direction: SpinDirection) {\r\n    this._stopSpinning();\r\n    this._spinTimer = setInterval(() => this.spin(direction * this.options.step), this.options.repeatInterval);\r\n  }\r\n\r\n  _stopSpinning () {\r\n    clearInterval(this._spinTimer);\r\n  }\r\n\r\n  _onWheel (e: WheelEvent) {\r\n    if (document.activeElement !== this.el) return;\r\n    e.preventDefault();\r\n\r\n    const direction: SpinDirection = (e.deltaY > 0 ? -1 : 1);\r\n    this.spin(direction * this.options.step);\r\n  }\r\n\r\n  get value (): number {\r\n    return this.options.parse(this.el.value) || 0;\r\n  }\r\n\r\n  set value (value: number) {\r\n    const strValue = this.options.format(this.options.parse(String(value)));\r\n    this.el.value = strValue;\r\n    if (this.options.onChange) this.options.onChange(strValue);\r\n  }\r\n\r\n  get disabled (): boolean {\r\n    return this._buttons.inc.disabled;\r\n  }\r\n\r\n  set disabled (disabled: boolean) {\r\n    if (this.disabled === disabled) return;\r\n\r\n    this._buttons.inc.disabled =\r\n    this._buttons.dec.disabled = disabled;\r\n  }\r\n\r\n  get precision (): number {\r\n    return Math.max(...[this.options.step, this.options.min]\r\n      .filter(v => v != null)\r\n      // $FlowFixMe already checked above\r\n      .map(precision));\r\n  }\r\n\r\n  adjustValue (value: number): number {\r\n    value = Number(value.toFixed(this.precision));\r\n\r\n    if (this.options.max != null && value > this.options.max) value = this.options.max;\r\n    if (this.options.min != null && value < this.options.min) value = this.options.min;\r\n\r\n    return value;\r\n  }\r\n\r\n  wrapValue (value: number): number {\r\n    if (this.options.wrapOverflow &&\r\n      this.options.max != null &&\r\n      this.options.min != null\r\n    ) {\r\n      if (value < this.options.min) value = this.options.max;\r\n      else if (value > this.options.max) value = this.options.min;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  spin (step: number) {\r\n    this.value = this.adjustValue(this.wrapValue(this.value + step));\r\n  }\r\n}\r\nISpin.DEFAULTS = {\r\n  wrapperClass: 'ispin-wrapper',\r\n  buttonsClass: 'ispin-button',\r\n  step: 1,\r\n  pageStep: 10,\r\n  disabled: false,\r\n  repeatInterval: 200,\r\n  wrapOverflow: false,\r\n  parse: Number,\r\n  format: String\r\n};\r\n\r\nfunction precision (num: number) {\r\n  return (String(num).split('.')[1] || '').length;\r\n}\r\n"],"names":["ISpin","el","opts","options","_onKeyDown","this","bind","_onMouseDown","_onMouseUp","_onMouseLeave","_onWheel","build","update","_wrapper","document","createElement","parentNode","replaceChild","appendChild","_buttons","inc","dec","Object","keys","forEach","k","b","_this","setAttribute","addEventListener","DEFAULTS","wrapperClass","classList","remove","add","buttonsClass","_this2","disabled","e","keyCode","preventDefault","spin","step","pageStep","direction","currentTarget","focus","_startSpinning","_stopSpinning","_spinTimer","setInterval","_this3","repeatInterval","clearInterval","activeElement","deltaY","value","Number","toFixed","precision","max","min","wrapOverflow","adjustValue","wrapValue","parse","strValue","format","String","onChange","Math","filter","v","map","num","split","length"],"mappings":"u/BAoBMA,wBAgBSC,EAAsBC,8GAC5BD,GAAKA,OAELE,QAAU,QAEVC,WAAaC,KAAKD,WAAWE,KAAKD,WAClCE,aAAeF,KAAKE,aAAaD,KAAKD,WACtCG,WAAaH,KAAKG,WAAWF,KAAKD,WAClCI,cAAgBJ,KAAKI,cAAcH,KAAKD,WACxCK,SAAWL,KAAKK,SAASJ,KAAKD,WAE9BM,aACAC,OAAOV,0EAKPW,SAAWC,SAASC,cAAc,OACnCV,KAAKJ,GAAGe,YAAYX,KAAKJ,GAAGe,WAAWC,aAAaZ,KAAKQ,SAAUR,KAAKJ,SACvEY,SAASK,YAAYb,KAAKJ,SAG1BkB,SAAW,CACdC,IAAKN,SAASC,cAAc,UAC5BM,IAAKP,SAASC,cAAc,WAI9BO,OAAOC,KAAKlB,KAAKc,UAAUK,QAAQ,SAAAC,OAC3BC,EAAIC,EAAKR,SAASM,GACxBE,EAAKd,SAASK,YAAYQ,GAC1BA,EAAEE,aAAa,OAAQ,UACvBF,EAAEG,iBAAiB,YAAaF,EAAKpB,cACrCmB,EAAEG,iBAAiB,UAAWF,EAAKnB,YACnCkB,EAAEG,iBAAiB,aAAcF,EAAKlB,sBAEnCR,GAAG4B,iBAAiB,UAAWxB,KAAKD,iBACpCH,GAAG4B,iBAAiB,QAASxB,KAAKK,yCAGjCR,eACNA,wUACKF,EAAM8B,SACNzB,KAAKF,QACLD,IAII6B,eAAiB1B,KAAKF,QAAQ4B,eACjC1B,KAAKF,QAAQ4B,cAAc1B,KAAKQ,SAASmB,UAAUC,OAAO5B,KAAKF,QAAQ4B,cACvE7B,EAAK6B,cAAc1B,KAAKQ,SAASmB,UAAUE,IAAIhC,EAAK6B,eAGtD7B,EAAKiC,eAAiB9B,KAAKF,QAAQgC,eACjC9B,KAAKF,QAAQgC,cACfb,OAAOC,KAAKlB,KAAKc,UAAUK,QAAQ,SAAAC,GACjCW,EAAKjB,SAASM,GAAGO,UAAUC,OAAOG,EAAKjC,QAAQgC,cAC/CC,EAAKjB,SAASM,GAAGO,UAAUC,OAAOG,EAAKjC,QAAQgC,aAAe,IAAMV,KAGpEvB,EAAKiC,cACPb,OAAOC,KAAKlB,KAAKc,UAAUK,QAAQ,SAAAC,GACjCW,EAAKjB,SAASM,GAAGO,UAAUE,IAAIhC,EAAKiC,cACpCC,EAAKjB,SAASM,GAAGO,UAAUE,IAAIhC,EAAKiC,aAAe,IAAMV,WAK1DY,SAAWnC,EAAKmC,WAEPhC,KAAKF,QAASD,qCAIxBG,KAAKQ,SAASG,YAAYX,KAAKQ,SAASG,WAAWC,aAAaZ,KAAKJ,GAAII,KAAKQ,iBAC3ER,KAAKJ,UACLI,KAAKQ,gBACLR,KAAKc,4CAGFmB,UACFA,EAAEC,cACH,UACHD,EAAEE,iBACKnC,KAAKoC,KAAKpC,KAAKF,QAAQuC,WAC3B,UACHJ,EAAEE,iBACKnC,KAAKoC,MAAMpC,KAAKF,QAAQuC,WAC5B,UACHJ,EAAEE,iBACKnC,KAAKoC,KAAKpC,KAAKF,QAAQwC,eAC3B,UACHL,EAAEE,iBACKnC,KAAKoC,MAAMpC,KAAKF,QAAQwC,gDAIvBL,GACZA,EAAEE,qBAEII,EAA2BN,EAAEO,gBAAkBxC,KAAKc,SAASC,IAAM,GAAK,OACzEqB,KAAKG,EAAYvC,KAAKF,QAAQuC,WAC9BzC,GAAG6C,aAEHC,eAAeH,sCAGVN,QACLU,sDAGQV,QACRU,uDAGSJ,mBACTI,qBACAC,WAAaC,YAAY,kBAAMC,EAAKV,KAAKG,EAAYO,EAAKhD,QAAQuC,OAAOrC,KAAKF,QAAQiD,wDAI3FC,cAAchD,KAAK4C,6CAGXX,MACJxB,SAASwC,gBAAkBjD,KAAKJ,IACpCqC,EAAEE,qBAEII,EAA4BN,EAAEiB,OAAS,GAAK,EAAI,OACjDd,KAAKG,EAAYvC,KAAKF,QAAQuC,2CA+BxBc,UACXA,EAAQC,OAAOD,EAAME,QAAQrD,KAAKsD,YAEV,MAApBtD,KAAKF,QAAQyD,KAAeJ,EAAQnD,KAAKF,QAAQyD,MAAKJ,EAAQnD,KAAKF,QAAQyD,KACvD,MAApBvD,KAAKF,QAAQ0D,KAAeL,EAAQnD,KAAKF,QAAQ0D,MAAKL,EAAQnD,KAAKF,QAAQ0D,KAExEL,oCAGEA,UACLnD,KAAKF,QAAQ2D,cACK,MAApBzD,KAAKF,QAAQyD,KACO,MAApBvD,KAAKF,QAAQ0D,MAETL,EAAQnD,KAAKF,QAAQ0D,IAAKL,EAAQnD,KAAKF,QAAQyD,IAC1CJ,EAAQnD,KAAKF,QAAQyD,MAAKJ,EAAQnD,KAAKF,QAAQ0D,MAEnDL,+BAGHd,QACCc,MAAQnD,KAAK0D,YAAY1D,KAAK2D,UAAU3D,KAAKmD,MAAQd,yCAhDnDrC,KAAKF,QAAQ8D,MAAM5D,KAAKJ,GAAGuD,QAAU,gBAGnCA,OACHU,EAAW7D,KAAKF,QAAQgE,OAAO9D,KAAKF,QAAQ8D,MAAMG,OAAOZ,UAC1DvD,GAAGuD,MAAQU,EACZ7D,KAAKF,QAAQkE,UAAUhE,KAAKF,QAAQkE,SAASH,2CAI1C7D,KAAKc,SAASC,IAAIiB,uBAGbA,GACRhC,KAAKgC,WAAaA,SAEjBlB,SAASC,IAAIiB,SAClBhC,KAAKc,SAASE,IAAIgB,SAAWA,4CAItBiC,KAAKV,UAALU,OAAY,CAACjE,KAAKF,QAAQuC,KAAMrC,KAAKF,QAAQ0D,KACjDU,OAAO,SAAAC,UAAU,MAALA,IAEZC,IAAId,0CAuCX,SAASA,EAAWe,UACVN,OAAOM,GAAKC,MAAM,KAAK,IAAM,IAAIC,cAb3C5E,EAAM8B,SAAW,CACfC,aAAc,gBACdI,aAAc,eACdO,KAAM,EACNC,SAAU,GACVN,UAAU,EACVe,eAAgB,IAChBU,cAAc,EACdG,MAAOR,OACPU,OAAQC"}