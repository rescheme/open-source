{"version":3,"file":"ispin.es.js","sources":["../src/ispin.js"],"sourcesContent":["// @flow\r\n\r\ntype SpinDirection = (1 | -1);\r\ntype SpinOptions = {\r\n  wrapperClass: string,\r\n  buttonsClass: string,\r\n  step: number,\r\n  pageStep: number,\r\n  repeatInterval: number,\r\n  wrapOverflow: boolean,\r\n  parse: string => number,\r\n  format: number => string,\r\n  disabled: boolean,\r\n  max?: number,\r\n  min?: number,\r\n  onChange?: string => void,\r\n};\r\n\r\n\r\nexport default\r\nclass ISpin {\r\n  static DEFAULTS: $Shape<SpinOptions>;\r\n  el: HTMLInputElement;\r\n  options: SpinOptions;\r\n  _onKeyDown: (e: KeyboardEvent) => void;\r\n  _onMouseDown: (e: MouseEvent) => void;\r\n  _onMouseUp: (e: MouseEvent) => void;\r\n  _onMouseLeave: (e: MouseEvent) => void;\r\n  _onWheel: (e: WheelEvent) => void;\r\n  _wrapper: HTMLElement;\r\n  _buttons: {\r\n    inc: HTMLButtonElement,\r\n    dec: HTMLButtonElement\r\n  };\r\n  _spinTimer: IntervalID;\r\n\r\n  constructor (el: HTMLInputElement, opts: $Shape<SpinOptions>) {\r\n    this.el = el;\r\n    // $FlowFixMe temporary assignment\r\n    this.options = {};\r\n\r\n    this._onKeyDown = this._onKeyDown.bind(this);\r\n    this._onMouseDown = this._onMouseDown.bind(this);\r\n    this._onMouseUp = this._onMouseUp.bind(this);\r\n    this._onMouseLeave = this._onMouseLeave.bind(this);\r\n    this._onWheel = this._onWheel.bind(this);\r\n\r\n    this.build();\r\n    this.update(opts);\r\n  }\r\n\r\n  build () {\r\n    // wrap element\r\n    this._wrapper = document.createElement('div');\r\n    if (this.el.parentNode) this.el.parentNode.replaceChild(this._wrapper, this.el);\r\n    this._wrapper.appendChild(this.el);\r\n\r\n    // add buttons\r\n    this._buttons = {\r\n      inc: document.createElement('button'),\r\n      dec: document.createElement('button')\r\n    };\r\n\r\n    // listen to events\r\n    Object.keys(this._buttons).forEach(k => {\r\n      const b = this._buttons[k];\r\n      this._wrapper.appendChild(b);\r\n      b.setAttribute('type', 'button');\r\n      b.addEventListener('mousedown', this._onMouseDown);\r\n      b.addEventListener('mouseup', this._onMouseUp);\r\n      b.addEventListener('mouseleave', this._onMouseLeave);\r\n    });\r\n    this.el.addEventListener('keydown', this._onKeyDown);\r\n    this.el.addEventListener('wheel', this._onWheel);\r\n  }\r\n\r\n  update (opts: $Shape<SpinOptions>) {\r\n    opts = {\r\n      ...ISpin.DEFAULTS,\r\n      ...this.options,\r\n      ...opts\r\n    };\r\n\r\n    // update wrapper class\r\n    if (opts.wrapperClass !== this.options.wrapperClass) {\r\n      if (this.options.wrapperClass) this._wrapper.classList.remove(this.options.wrapperClass);\r\n      if (opts.wrapperClass) this._wrapper.classList.add(opts.wrapperClass);\r\n    }\r\n\r\n    if (opts.buttonsClass !== this.options.buttonsClass) {\r\n      if (this.options.buttonsClass) {\r\n        Object.keys(this._buttons).forEach(k => {\r\n          this._buttons[k].classList.remove(this.options.buttonsClass);\r\n          this._buttons[k].classList.remove(this.options.buttonsClass + '-' + k);\r\n        });\r\n      }\r\n      if (opts.buttonsClass) {\r\n        Object.keys(this._buttons).forEach(k => {\r\n          this._buttons[k].classList.add(opts.buttonsClass);\r\n          this._buttons[k].classList.add(opts.buttonsClass + '-' + k);\r\n        });\r\n      }\r\n    }\r\n\r\n    this.disabled = opts.disabled;\r\n\r\n    Object.assign(this.options, opts);\r\n  }\r\n\r\n  destroy () {\r\n    if (this._wrapper.parentNode) this._wrapper.parentNode.replaceChild(this.el, this._wrapper);\r\n    delete this.el;\r\n    delete this._wrapper;\r\n    delete this._buttons;\r\n  }\r\n\r\n  _onKeyDown (e: KeyboardEvent) {\r\n    switch (e.keyCode) {\r\n      case 38: // arrow up\r\n        e.preventDefault();\r\n        return this.spin(this.options.step);\r\n      case 40: // arrow down\r\n        e.preventDefault();\r\n        return this.spin(-this.options.step);\r\n      case 33: // page up\r\n        e.preventDefault();\r\n        return this.spin(this.options.pageStep);\r\n      case 34: // page down\r\n        e.preventDefault();\r\n        return this.spin(-this.options.pageStep);\r\n    }\r\n  }\r\n\r\n  _onMouseDown (e: MouseEvent) {\r\n    e.preventDefault();\r\n\r\n    const direction: SpinDirection = e.currentTarget === this._buttons.inc ? 1 : -1;\r\n    this.spin(direction * this.options.step);\r\n    this.el.focus();\r\n\r\n    this._startSpinning(direction);\r\n  }\r\n\r\n  _onMouseUp (e: MouseEvent) {\r\n    this._stopSpinning();\r\n  }\r\n\r\n  _onMouseLeave (e: MouseEvent) {\r\n    this._stopSpinning();\r\n  }\r\n\r\n  _startSpinning (direction: SpinDirection) {\r\n    this._stopSpinning();\r\n    this._spinTimer = setInterval(() => this.spin(direction * this.options.step), this.options.repeatInterval);\r\n  }\r\n\r\n  _stopSpinning () {\r\n    clearInterval(this._spinTimer);\r\n  }\r\n\r\n  _onWheel (e: WheelEvent) {\r\n    if (document.activeElement !== this.el) return;\r\n    e.preventDefault();\r\n\r\n    const direction: SpinDirection = (e.deltaY > 0 ? -1 : 1);\r\n    this.spin(direction * this.options.step);\r\n  }\r\n\r\n  get value (): number {\r\n    return this.options.parse(this.el.value) || 0;\r\n  }\r\n\r\n  set value (value: number) {\r\n    const strValue = this.options.format(this.options.parse(String(value)));\r\n    this.el.value = strValue;\r\n    if (this.options.onChange) this.options.onChange(strValue);\r\n  }\r\n\r\n  get disabled (): boolean {\r\n    return this._buttons.inc.disabled;\r\n  }\r\n\r\n  set disabled (disabled: boolean) {\r\n    if (this.disabled === disabled) return;\r\n\r\n    this._buttons.inc.disabled =\r\n    this._buttons.dec.disabled = disabled;\r\n  }\r\n\r\n  get precision (): number {\r\n    return Math.max(...[this.options.step, this.options.min]\r\n      .filter(v => v != null)\r\n      // $FlowFixMe already checked above\r\n      .map(precision));\r\n  }\r\n\r\n  adjustValue (value: number): number {\r\n    value = Number(value.toFixed(this.precision));\r\n\r\n    if (this.options.max != null && value > this.options.max) value = this.options.max;\r\n    if (this.options.min != null && value < this.options.min) value = this.options.min;\r\n\r\n    return value;\r\n  }\r\n\r\n  wrapValue (value: number): number {\r\n    if (this.options.wrapOverflow &&\r\n      this.options.max != null &&\r\n      this.options.min != null\r\n    ) {\r\n      if (value < this.options.min) value = this.options.max;\r\n      else if (value > this.options.max) value = this.options.min;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  spin (step: number) {\r\n    this.value = this.adjustValue(this.wrapValue(this.value + step));\r\n  }\r\n}\r\nISpin.DEFAULTS = {\r\n  wrapperClass: 'ispin-wrapper',\r\n  buttonsClass: 'ispin-button',\r\n  step: 1,\r\n  pageStep: 10,\r\n  disabled: false,\r\n  repeatInterval: 200,\r\n  wrapOverflow: false,\r\n  parse: Number,\r\n  format: String\r\n};\r\n\r\nfunction precision (num: number) {\r\n  return (String(num).split('.')[1] || '').length;\r\n}\r\n"],"names":["ISpin","constructor","el","opts","options","_onKeyDown","bind","_onMouseDown","_onMouseUp","_onMouseLeave","_onWheel","build","update","_wrapper","document","createElement","parentNode","replaceChild","appendChild","_buttons","inc","dec","Object","keys","forEach","k","b","setAttribute","addEventListener","DEFAULTS","wrapperClass","classList","remove","add","buttonsClass","disabled","assign","destroy","e","keyCode","preventDefault","spin","step","pageStep","direction","currentTarget","focus","_startSpinning","_stopSpinning","_spinTimer","setInterval","repeatInterval","clearInterval","activeElement","deltaY","value","parse","strValue","format","String","onChange","precision","Math","max","min","filter","v","map","adjustValue","Number","toFixed","wrapValue","wrapOverflow","num","split","length"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,MAAMA,KAAN,CAAY;EAgBVC,WAAW,CAAEC,EAAF,EAAwBC,IAAxB,EAAmD;SACvDD,EAAL,GAAUA,EAAV,CAD4D;;SAGvDE,OAAL,GAAe,EAAf;SAEKC,UAAL,GAAkB,KAAKA,UAAL,CAAgBC,IAAhB,CAAqB,IAArB,CAAlB;SACKC,YAAL,GAAoB,KAAKA,YAAL,CAAkBD,IAAlB,CAAuB,IAAvB,CAApB;SACKE,UAAL,GAAkB,KAAKA,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAAlB;SACKG,aAAL,GAAqB,KAAKA,aAAL,CAAmBH,IAAnB,CAAwB,IAAxB,CAArB;SACKI,QAAL,GAAgB,KAAKA,QAAL,CAAcJ,IAAd,CAAmB,IAAnB,CAAhB;SAEKK,KAAL;SACKC,MAAL,CAAYT,IAAZ;;;EAGFQ,KAAK,GAAI;;SAEFE,QAAL,GAAgBC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAhB;QACI,KAAKb,EAAL,CAAQc,UAAZ,EAAwB,KAAKd,EAAL,CAAQc,UAAR,CAAmBC,YAAnB,CAAgC,KAAKJ,QAArC,EAA+C,KAAKX,EAApD;;SACnBW,QAAL,CAAcK,WAAd,CAA0B,KAAKhB,EAA/B,EAJO;;;SAOFiB,QAAL,GAAgB;MACdC,GAAG,EAAEN,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CADS;MAEdM,GAAG,EAAEP,QAAQ,CAACC,aAAT,CAAuB,QAAvB;KAFP,CAPO;;IAaPO,MAAM,CAACC,IAAP,CAAY,KAAKJ,QAAjB,EAA2BK,OAA3B,CAAmCC,CAAC,IAAI;YAChCC,CAAC,GAAG,KAAKP,QAAL,CAAcM,CAAd,CAAV;;WACKZ,QAAL,CAAcK,WAAd,CAA0BQ,CAA1B;;MACAA,CAAC,CAACC,YAAF,CAAe,MAAf,EAAuB,QAAvB;MACAD,CAAC,CAACE,gBAAF,CAAmB,WAAnB,EAAgC,KAAKrB,YAArC;MACAmB,CAAC,CAACE,gBAAF,CAAmB,SAAnB,EAA8B,KAAKpB,UAAnC;MACAkB,CAAC,CAACE,gBAAF,CAAmB,YAAnB,EAAiC,KAAKnB,aAAtC;KANF;SAQKP,EAAL,CAAQ0B,gBAAR,CAAyB,SAAzB,EAAoC,KAAKvB,UAAzC;SACKH,EAAL,CAAQ0B,gBAAR,CAAyB,OAAzB,EAAkC,KAAKlB,QAAvC;;;EAGFE,MAAM,CAAET,IAAF,EAA6B;IACjCA,IAAI,qBACCH,KAAK,CAAC6B,QADP,EAEC,KAAKzB,OAFN,EAGCD,IAHD,CAAJ,CADiC;;QAQ7BA,IAAI,CAAC2B,YAAL,KAAsB,KAAK1B,OAAL,CAAa0B,YAAvC,EAAqD;UAC/C,KAAK1B,OAAL,CAAa0B,YAAjB,EAA+B,KAAKjB,QAAL,CAAckB,SAAd,CAAwBC,MAAxB,CAA+B,KAAK5B,OAAL,CAAa0B,YAA5C;UAC3B3B,IAAI,CAAC2B,YAAT,EAAuB,KAAKjB,QAAL,CAAckB,SAAd,CAAwBE,GAAxB,CAA4B9B,IAAI,CAAC2B,YAAjC;;;QAGrB3B,IAAI,CAAC+B,YAAL,KAAsB,KAAK9B,OAAL,CAAa8B,YAAvC,EAAqD;UAC/C,KAAK9B,OAAL,CAAa8B,YAAjB,EAA+B;QAC7BZ,MAAM,CAACC,IAAP,CAAY,KAAKJ,QAAjB,EAA2BK,OAA3B,CAAmCC,CAAC,IAAI;eACjCN,QAAL,CAAcM,CAAd,EAAiBM,SAAjB,CAA2BC,MAA3B,CAAkC,KAAK5B,OAAL,CAAa8B,YAA/C;;eACKf,QAAL,CAAcM,CAAd,EAAiBM,SAAjB,CAA2BC,MAA3B,CAAkC,KAAK5B,OAAL,CAAa8B,YAAb,GAA4B,GAA5B,GAAkCT,CAApE;SAFF;;;UAKEtB,IAAI,CAAC+B,YAAT,EAAuB;QACrBZ,MAAM,CAACC,IAAP,CAAY,KAAKJ,QAAjB,EAA2BK,OAA3B,CAAmCC,CAAC,IAAI;eACjCN,QAAL,CAAcM,CAAd,EAAiBM,SAAjB,CAA2BE,GAA3B,CAA+B9B,IAAI,CAAC+B,YAApC;;eACKf,QAAL,CAAcM,CAAd,EAAiBM,SAAjB,CAA2BE,GAA3B,CAA+B9B,IAAI,CAAC+B,YAAL,GAAoB,GAApB,GAA0BT,CAAzD;SAFF;;;;SAOCU,QAAL,GAAgBhC,IAAI,CAACgC,QAArB;IAEAb,MAAM,CAACc,MAAP,CAAc,KAAKhC,OAAnB,EAA4BD,IAA5B;;;EAGFkC,OAAO,GAAI;QACL,KAAKxB,QAAL,CAAcG,UAAlB,EAA8B,KAAKH,QAAL,CAAcG,UAAd,CAAyBC,YAAzB,CAAsC,KAAKf,EAA3C,EAA+C,KAAKW,QAApD;WACvB,KAAKX,EAAZ;WACO,KAAKW,QAAZ;WACO,KAAKM,QAAZ;;;EAGFd,UAAU,CAAEiC,CAAF,EAAoB;YACpBA,CAAC,CAACC,OAAV;WACO,EAAL;;QACED,CAAC,CAACE,cAAF;eACO,KAAKC,IAAL,CAAU,KAAKrC,OAAL,CAAasC,IAAvB,CAAP;;WACG,EAAL;;QACEJ,CAAC,CAACE,cAAF;eACO,KAAKC,IAAL,CAAU,CAAC,KAAKrC,OAAL,CAAasC,IAAxB,CAAP;;WACG,EAAL;;QACEJ,CAAC,CAACE,cAAF;eACO,KAAKC,IAAL,CAAU,KAAKrC,OAAL,CAAauC,QAAvB,CAAP;;WACG,EAAL;;QACEL,CAAC,CAACE,cAAF;eACO,KAAKC,IAAL,CAAU,CAAC,KAAKrC,OAAL,CAAauC,QAAxB,CAAP;;;;EAINpC,YAAY,CAAE+B,CAAF,EAAiB;IAC3BA,CAAC,CAACE,cAAF;UAEMI,SAAwB,GAAGN,CAAC,CAACO,aAAF,KAAoB,KAAK1B,QAAL,CAAcC,GAAlC,GAAwC,CAAxC,GAA4C,CAAC,CAA9E;SACKqB,IAAL,CAAUG,SAAS,GAAG,KAAKxC,OAAL,CAAasC,IAAnC;SACKxC,EAAL,CAAQ4C,KAAR;;SAEKC,cAAL,CAAoBH,SAApB;;;EAGFpC,UAAU,CAAE8B,CAAF,EAAiB;SACpBU,aAAL;;;EAGFvC,aAAa,CAAE6B,CAAF,EAAiB;SACvBU,aAAL;;;EAGFD,cAAc,CAAEH,SAAF,EAA4B;SACnCI,aAAL;;SACKC,UAAL,GAAkBC,WAAW,CAAC,MAAM,KAAKT,IAAL,CAAUG,SAAS,GAAG,KAAKxC,OAAL,CAAasC,IAAnC,CAAP,EAAiD,KAAKtC,OAAL,CAAa+C,cAA9D,CAA7B;;;EAGFH,aAAa,GAAI;IACfI,aAAa,CAAC,KAAKH,UAAN,CAAb;;;EAGFvC,QAAQ,CAAE4B,CAAF,EAAiB;QACnBxB,QAAQ,CAACuC,aAAT,KAA2B,KAAKnD,EAApC,EAAwC;IACxCoC,CAAC,CAACE,cAAF;UAEMI,SAAwB,GAAIN,CAAC,CAACgB,MAAF,GAAW,CAAX,GAAe,CAAC,CAAhB,GAAoB,CAAtD;SACKb,IAAL,CAAUG,SAAS,GAAG,KAAKxC,OAAL,CAAasC,IAAnC;;;MAGEa,KAAJ,GAAqB;WACZ,KAAKnD,OAAL,CAAaoD,KAAb,CAAmB,KAAKtD,EAAL,CAAQqD,KAA3B,KAAqC,CAA5C;;;MAGEA,KAAJ,CAAWA,KAAX,EAA0B;UAClBE,QAAQ,GAAG,KAAKrD,OAAL,CAAasD,MAAb,CAAoB,KAAKtD,OAAL,CAAaoD,KAAb,CAAmBG,MAAM,CAACJ,KAAD,CAAzB,CAApB,CAAjB;SACKrD,EAAL,CAAQqD,KAAR,GAAgBE,QAAhB;QACI,KAAKrD,OAAL,CAAawD,QAAjB,EAA2B,KAAKxD,OAAL,CAAawD,QAAb,CAAsBH,QAAtB;;;MAGzBtB,QAAJ,GAAyB;WAChB,KAAKhB,QAAL,CAAcC,GAAd,CAAkBe,QAAzB;;;MAGEA,QAAJ,CAAcA,QAAd,EAAiC;QAC3B,KAAKA,QAAL,KAAkBA,QAAtB,EAAgC;SAE3BhB,QAAL,CAAcC,GAAd,CAAkBe,QAAlB,GACA,KAAKhB,QAAL,CAAcE,GAAd,CAAkBc,QAAlB,GAA6BA,QAD7B;;;MAIE0B,SAAJ,GAAyB;WAChBC,IAAI,CAACC,GAAL,CAAS,GAAG,CAAC,KAAK3D,OAAL,CAAasC,IAAd,EAAoB,KAAKtC,OAAL,CAAa4D,GAAjC,EAChBC,MADgB,CACTC,CAAC,IAAIA,CAAC,IAAI,IADD;KAGhBC,GAHgB,CAGZN,SAHY,CAAZ,CAAP;;;EAMFO,WAAW,CAAEb,KAAF,EAAyB;IAClCA,KAAK,GAAGc,MAAM,CAACd,KAAK,CAACe,OAAN,CAAc,KAAKT,SAAnB,CAAD,CAAd;QAEI,KAAKzD,OAAL,CAAa2D,GAAb,IAAoB,IAApB,IAA4BR,KAAK,GAAG,KAAKnD,OAAL,CAAa2D,GAArD,EAA0DR,KAAK,GAAG,KAAKnD,OAAL,CAAa2D,GAArB;QACtD,KAAK3D,OAAL,CAAa4D,GAAb,IAAoB,IAApB,IAA4BT,KAAK,GAAG,KAAKnD,OAAL,CAAa4D,GAArD,EAA0DT,KAAK,GAAG,KAAKnD,OAAL,CAAa4D,GAArB;WAEnDT,KAAP;;;EAGFgB,SAAS,CAAEhB,KAAF,EAAyB;QAC5B,KAAKnD,OAAL,CAAaoE,YAAb,IACF,KAAKpE,OAAL,CAAa2D,GAAb,IAAoB,IADlB,IAEF,KAAK3D,OAAL,CAAa4D,GAAb,IAAoB,IAFtB,EAGE;UACIT,KAAK,GAAG,KAAKnD,OAAL,CAAa4D,GAAzB,EAA8BT,KAAK,GAAG,KAAKnD,OAAL,CAAa2D,GAArB,CAA9B,KACK,IAAIR,KAAK,GAAG,KAAKnD,OAAL,CAAa2D,GAAzB,EAA8BR,KAAK,GAAG,KAAKnD,OAAL,CAAa4D,GAArB;;;WAE9BT,KAAP;;;EAGFd,IAAI,CAAEC,IAAF,EAAgB;SACba,KAAL,GAAa,KAAKa,WAAL,CAAiB,KAAKG,SAAL,CAAe,KAAKhB,KAAL,GAAab,IAA5B,CAAjB,CAAb;;;;AAGJ1C,KAAK,CAAC6B,QAAN,GAAiB;EACfC,YAAY,EAAE,eADC;EAEfI,YAAY,EAAE,cAFC;EAGfQ,IAAI,EAAE,CAHS;EAIfC,QAAQ,EAAE,EAJK;EAKfR,QAAQ,EAAE,KALK;EAMfgB,cAAc,EAAE,GAND;EAOfqB,YAAY,EAAE,KAPC;EAQfhB,KAAK,EAAEa,MARQ;EASfX,MAAM,EAAEC;CATV;;AAYA,SAASE,SAAT,CAAoBY,GAApB,EAAiC;SACxB,CAACd,MAAM,CAACc,GAAD,CAAN,CAAYC,KAAZ,CAAkB,GAAlB,EAAuB,CAAvB,KAA6B,EAA9B,EAAkCC,MAAzC;;;;;"}