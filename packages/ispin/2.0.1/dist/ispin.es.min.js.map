{"version":3,"file":"ispin.es.min.js","sources":["../src/ispin.js"],"sourcesContent":["// @flow\r\n\r\ntype SpinDirection = (1 | -1);\r\ntype SpinOptions = {\r\n  wrapperClass: string,\r\n  buttonsClass: string,\r\n  step: number,\r\n  pageStep: number,\r\n  repeatInterval: number,\r\n  wrapOverflow: boolean,\r\n  parse: string => number,\r\n  format: number => string,\r\n  disabled: boolean,\r\n  max?: number,\r\n  min?: number,\r\n  onChange?: string => void,\r\n};\r\n\r\n\r\nexport default\r\nclass ISpin {\r\n  static DEFAULTS: $Shape<SpinOptions>;\r\n  el: HTMLInputElement;\r\n  options: SpinOptions;\r\n  _onKeyDown: (e: KeyboardEvent) => void;\r\n  _onMouseDown: (e: MouseEvent) => void;\r\n  _onMouseUp: (e: MouseEvent) => void;\r\n  _onMouseLeave: (e: MouseEvent) => void;\r\n  _onWheel: (e: WheelEvent) => void;\r\n  _wrapper: HTMLElement;\r\n  _buttons: {\r\n    inc: HTMLButtonElement,\r\n    dec: HTMLButtonElement\r\n  };\r\n  _spinTimer: IntervalID;\r\n\r\n  constructor (el: HTMLInputElement, opts: $Shape<SpinOptions>) {\r\n    this.el = el;\r\n    // $FlowFixMe temporary assignment\r\n    this.options = {};\r\n\r\n    this._onKeyDown = this._onKeyDown.bind(this);\r\n    this._onMouseDown = this._onMouseDown.bind(this);\r\n    this._onMouseUp = this._onMouseUp.bind(this);\r\n    this._onMouseLeave = this._onMouseLeave.bind(this);\r\n    this._onWheel = this._onWheel.bind(this);\r\n\r\n    this.build();\r\n    this.update(opts);\r\n  }\r\n\r\n  build () {\r\n    // wrap element\r\n    this._wrapper = document.createElement('div');\r\n    if (this.el.parentNode) this.el.parentNode.replaceChild(this._wrapper, this.el);\r\n    this._wrapper.appendChild(this.el);\r\n\r\n    // add buttons\r\n    this._buttons = {\r\n      inc: document.createElement('button'),\r\n      dec: document.createElement('button')\r\n    };\r\n\r\n    // listen to events\r\n    Object.keys(this._buttons).forEach(k => {\r\n      const b = this._buttons[k];\r\n      this._wrapper.appendChild(b);\r\n      b.setAttribute('type', 'button');\r\n      b.addEventListener('mousedown', this._onMouseDown);\r\n      b.addEventListener('mouseup', this._onMouseUp);\r\n      b.addEventListener('mouseleave', this._onMouseLeave);\r\n    });\r\n    this.el.addEventListener('keydown', this._onKeyDown);\r\n    this.el.addEventListener('wheel', this._onWheel);\r\n  }\r\n\r\n  update (opts: $Shape<SpinOptions>) {\r\n    opts = {\r\n      ...ISpin.DEFAULTS,\r\n      ...this.options,\r\n      ...opts\r\n    };\r\n\r\n    // update wrapper class\r\n    if (opts.wrapperClass !== this.options.wrapperClass) {\r\n      if (this.options.wrapperClass) this._wrapper.classList.remove(this.options.wrapperClass);\r\n      if (opts.wrapperClass) this._wrapper.classList.add(opts.wrapperClass);\r\n    }\r\n\r\n    if (opts.buttonsClass !== this.options.buttonsClass) {\r\n      if (this.options.buttonsClass) {\r\n        Object.keys(this._buttons).forEach(k => {\r\n          this._buttons[k].classList.remove(this.options.buttonsClass);\r\n          this._buttons[k].classList.remove(this.options.buttonsClass + '-' + k);\r\n        });\r\n      }\r\n      if (opts.buttonsClass) {\r\n        Object.keys(this._buttons).forEach(k => {\r\n          this._buttons[k].classList.add(opts.buttonsClass);\r\n          this._buttons[k].classList.add(opts.buttonsClass + '-' + k);\r\n        });\r\n      }\r\n    }\r\n\r\n    this.disabled = opts.disabled;\r\n\r\n    Object.assign(this.options, opts);\r\n  }\r\n\r\n  destroy () {\r\n    if (this._wrapper.parentNode) this._wrapper.parentNode.replaceChild(this.el, this._wrapper);\r\n    delete this.el;\r\n    delete this._wrapper;\r\n    delete this._buttons;\r\n  }\r\n\r\n  _onKeyDown (e: KeyboardEvent) {\r\n    switch (e.keyCode) {\r\n      case 38: // arrow up\r\n        e.preventDefault();\r\n        return this.spin(this.options.step);\r\n      case 40: // arrow down\r\n        e.preventDefault();\r\n        return this.spin(-this.options.step);\r\n      case 33: // page up\r\n        e.preventDefault();\r\n        return this.spin(this.options.pageStep);\r\n      case 34: // page down\r\n        e.preventDefault();\r\n        return this.spin(-this.options.pageStep);\r\n    }\r\n  }\r\n\r\n  _onMouseDown (e: MouseEvent) {\r\n    e.preventDefault();\r\n\r\n    const direction: SpinDirection = e.currentTarget === this._buttons.inc ? 1 : -1;\r\n    this.spin(direction * this.options.step);\r\n    this.el.focus();\r\n\r\n    this._startSpinning(direction);\r\n  }\r\n\r\n  _onMouseUp (e: MouseEvent) {\r\n    this._stopSpinning();\r\n  }\r\n\r\n  _onMouseLeave (e: MouseEvent) {\r\n    this._stopSpinning();\r\n  }\r\n\r\n  _startSpinning (direction: SpinDirection) {\r\n    this._stopSpinning();\r\n    this._spinTimer = setInterval(() => this.spin(direction * this.options.step), this.options.repeatInterval);\r\n  }\r\n\r\n  _stopSpinning () {\r\n    clearInterval(this._spinTimer);\r\n  }\r\n\r\n  _onWheel (e: WheelEvent) {\r\n    if (document.activeElement !== this.el) return;\r\n    e.preventDefault();\r\n\r\n    const direction: SpinDirection = (e.deltaY > 0 ? -1 : 1);\r\n    this.spin(direction * this.options.step);\r\n  }\r\n\r\n  get value (): number {\r\n    return this.options.parse(this.el.value) || 0;\r\n  }\r\n\r\n  set value (value: number) {\r\n    const strValue = this.options.format(this.options.parse(String(value)));\r\n    this.el.value = strValue;\r\n    if (this.options.onChange) this.options.onChange(strValue);\r\n  }\r\n\r\n  get disabled (): boolean {\r\n    return this._buttons.inc.disabled;\r\n  }\r\n\r\n  set disabled (disabled: boolean) {\r\n    if (this.disabled === disabled) return;\r\n\r\n    this._buttons.inc.disabled =\r\n    this._buttons.dec.disabled = disabled;\r\n  }\r\n\r\n  get precision (): number {\r\n    return Math.max(...[this.options.step, this.options.min]\r\n      .filter(v => v != null)\r\n      // $FlowFixMe already checked above\r\n      .map(precision));\r\n  }\r\n\r\n  adjustValue (value: number): number {\r\n    value = Number(value.toFixed(this.precision));\r\n\r\n    if (this.options.max != null && value > this.options.max) value = this.options.max;\r\n    if (this.options.min != null && value < this.options.min) value = this.options.min;\r\n\r\n    return value;\r\n  }\r\n\r\n  wrapValue (value: number): number {\r\n    if (this.options.wrapOverflow &&\r\n      this.options.max != null &&\r\n      this.options.min != null\r\n    ) {\r\n      if (value < this.options.min) value = this.options.max;\r\n      else if (value > this.options.max) value = this.options.min;\r\n    }\r\n    return value;\r\n  }\r\n\r\n  spin (step: number) {\r\n    this.value = this.adjustValue(this.wrapValue(this.value + step));\r\n  }\r\n}\r\nISpin.DEFAULTS = {\r\n  wrapperClass: 'ispin-wrapper',\r\n  buttonsClass: 'ispin-button',\r\n  step: 1,\r\n  pageStep: 10,\r\n  disabled: false,\r\n  repeatInterval: 200,\r\n  wrapOverflow: false,\r\n  parse: Number,\r\n  format: String\r\n};\r\n\r\nfunction precision (num: number) {\r\n  return (String(num).split('.')[1] || '').length;\r\n}\r\n"],"names":["ISpin","constructor","el","opts","options","_onKeyDown","this","bind","_onMouseDown","_onMouseUp","_onMouseLeave","_onWheel","build","update","_wrapper","document","createElement","parentNode","replaceChild","appendChild","_buttons","inc","dec","Object","keys","forEach","k","b","setAttribute","addEventListener","DEFAULTS","wrapperClass","classList","remove","add","buttonsClass","disabled","assign","destroy","e","keyCode","preventDefault","spin","step","pageStep","direction","currentTarget","focus","_startSpinning","_stopSpinning","_spinTimer","setInterval","repeatInterval","clearInterval","activeElement","deltaY","parse","value","strValue","format","String","onChange","Math","max","min","filter","v","map","precision","adjustValue","Number","toFixed","wrapValue","wrapOverflow","num","split","length"],"mappings":"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"}